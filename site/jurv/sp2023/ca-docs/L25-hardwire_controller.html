<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>硬布线控制实验 :: RISC-V CPU设计实验教程</title>
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">RISC-V CPU设计实验教程</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="http://welab.ujs.edu.cn/new" target="_blank">Home</a>

        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://gitee.com/fpga-lab/jurv-open" target="_blank">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jurv" data-version="sp2023">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RISC-V CPU设计实验教程</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">前言</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../brief-of-parts.html">实验内容的组织</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../video-links.html">教学视频资源</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">实验工具和环境</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../L02-lab-tools.html">实验工具和环境概述</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sv2-grammar.html">Verilog HDL语法概要</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../L01-guide.html">Quartus FPGA设计流程</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L01-guide.html#准备工作">准备工作</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L01-guide.html#实验步骤">实验步骤</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L01a-faq-quartus.html">常见编译错误</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L01b-tcl-create-quartus-project.html">用脚本文件创建工程</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../L02-guide-remote.html">远程实验验证流程</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-login.html">登录远程实验平台</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-remote.html#准备工作">准备工作</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-remote.html#验证流程">验证流程</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-remote.html#设计虚拟面板">设计虚拟面板</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-remote.html#实验考核">实验考核</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../L02-guide-local-welab.html">本地实验验证流程-WeLab版</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-welab.html#准备工作">准备工作</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-welab.html#验证流程">验证流程</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-welab.html#设计虚拟面板">设计虚拟面板</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-welab.html#Quartus下载sof">使用Quartus软件下载sof文件</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../L02-guide-local-julab.html">本地实验验证流程-JULAB版</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-julab.html#准备工作">准备工作</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-julab.html#验证流程">验证流程</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-julab.html#设计虚拟面板">设计虚拟面板</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../L02-guide-local-julab.html#Quartus下载sof">使用Quartus软件下载sof文件</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../L02-quartus-revision.html">线上线下混合模式的工程设置</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">逻辑电路实验</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/sv3-1-combinational.html">组合逻辑的Verilog HDL描述（一）</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L11-tristate_mux.html">三态门和多路器实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/sv3-2-combinational.html">组合逻辑的Verilog HDL描述（二）</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/sv5-hierarchical.html">层次化和参数化设计</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L12-decoder.html">译码器实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/sv4-sequential.html">时序逻辑的Verilog HDL描述</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L13-register_file.html">寄存器堆实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L14-shift_led.html">流水灯与移位寄存器实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L15-counter_divider.html">计数器与分频器实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/sv6-control.html">顺序控制逻辑的Verilog HDL描述</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L16-led_pattern_controller.html">彩灯控制器实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sv-docs/L17-stream_cipher.html">流密码器实验</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">计算机组成实验</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="L21-add_sub_operation.html">加减运算电路实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="L22-arithmetic_logic_unit.html">算术逻辑单元实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="L23-single_cycle_datapath.html">单周期数据通路实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="L24-memory.html">存储器实验</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="L25-hardwire_controller.html">硬布线控制实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="L26-riscv_assembly.html">RISC-V汇编语言实验</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="L27-riscv_micro_architecture.html">RISC-V微架构实验</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RISC-V CPU设计实验</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text">实现ADDI指令</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">实现整数运算指令</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">实现访存指令和简单IO</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">实现分支指令</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">初步实现流水线</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">支持27条指令</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">解决流水线数据冲突</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">解决流水线控制冲突</span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RISC-V CPU设计实验教程</span>
    <span class="version">sp2023</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../teach/index.html">FPGA实验云 ● 教师指南</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../teach/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">RISC-V CPU设计实验教程</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">sp2023</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">RISC-V CPU设计实验教程</a></li>
    <li>计算机组成实验</li>
    <li><a href="L25-hardwire_controller.html">硬布线控制实验</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="页内目录" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">硬布线控制实验</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本实验为软件工程专业选做实验。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_实验目的"><a class="anchor" href="#_实验目的"></a>实验目的</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>理解单周期数据通路的组成结构及其信息加工过程。</p>
</li>
<li>
<p>掌握单周期硬布线控制信号的产生原理和设计方法；</p>
</li>
<li>
<p>理解精简指令的特点。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_单周期数据通路"><a class="anchor" href="#_单周期数据通路"></a>单周期数据通路</h2>
<div class="sectionbody">
<div class="paragraph">
<p>“周期”是指时钟周期，如果完成一次运算只需要一个时钟周期，就称为单周期数据通路；需要几个时钟周期才能完成一次运算则称为多周期数据通路。单周期数据通路很容易演变为流水线数据通路，多为RISC处理器采用。</p>
</div>
<div class="paragraph">
<p>本实验分为单周期数据通路和硬布线控制两部分。在数据通路部分，通过开关手动输入控制信号完成运算过程是；然后在硬布线控制部分，通过指令指挥控制器产生控制信号完成运算过程。</p>
</div>
<div class="sect2">
<h3 id="_原理"><a class="anchor" href="#_原理"></a>原理</h3>
<div class="paragraph">
<p><a href="#fig-30">图 1</a>是本实验的单周期数据通路，该数据通路使用了前面实验中的ALU和三端口寄存器堆，2个读端口向ALU的两个输入端提供运算数据，1个写端口接收ALU的运算结果，可以一个周期完成读数据、运算、存结果。ALU模块使用前面算术逻辑单元实验中自己设计的ALU，ALUop的编码和比较运算均按照前面实验的要求；三端口寄存器堆使用存储器实验中完成的。实验材料给出了VirtualBoard模块的代码，包含了对ALU和寄存器堆的实例化。</p>
</div>
<div id="fig-30" class="imageblock">
<div class="content">
<img src="_images/lab-image30.png" alt="单周期数据通路" width="461" height="277">
</div>
<div class="title">图 1. 单周期数据通路</div>
</div>
</div>
<div class="sect2">
<h3 id="_数据通路的操作"><a class="anchor" href="#_数据通路的操作"></a>数据通路的操作</h3>
<div class="paragraph">
<p>完成以下验证操作。</p>
</div>
<div class="paragraph">
<p>1）将2个数据存入R1、R2寄存器</p>
</div>
<div class="paragraph">
<p>数据通过Data开关设置。从数据通路图可以看出，Data并没有直接连在寄存器堆的写端口，而是经过多路器后送到了ALU的Y输入端；为了将Data送到寄存器堆的写端口，必须经过ALU。在前面寄存器堆的实验中已经设计R0寄存器的值恒为0，可以用ALU将Data加上R0寄存器值，将Data传送到寄存器堆的写端口。</p>
</div>
<div class="paragraph">
<p>2）完成ALU运算</p>
</div>
<div class="paragraph">
<p>运算数是R1、R2或者R1、Data。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_硬布线控制"><a class="anchor" href="#_硬布线控制"></a>硬布线控制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在上面数据通路的基础上，增加指令存储器、控制器等部件，可以看成是一个简单的CPU。原理框图如<a href="#fig-31">图 2</a>。</p>
</div>
<div id="fig-31" class="imageblock">
<div class="content">
<img src="_images/lab-image31.png" alt="硬布线控制器_300dpi" width="578" height="334">
</div>
<div class="title">图 2. 单周期数据通路及控制</div>
</div>
<div class="sect2">
<h3 id="_指令系统"><a class="anchor" href="#_指令系统"></a>指令系统</h3>
<div class="paragraph">
<p>包含运算器和控制器的实验电路看成是一个简单的CPU，根据ALU所能够实现算术及逻辑运算功能，以及运算器数据通路的结构，设计了R型和I型运算指令以及B型分支指令，指令格式如下。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 7.0707%;">
<col style="width: 7.0707%;">
<col style="width: 7.0707%;">
<col style="width: 7.0707%;">
<col style="width: 7.0707%;">
<col style="width: 7.0707%;">
<col style="width: 12.1212%;">
<col style="width: 12.1213%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">OPCODE</p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Rs1</p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Rs2</p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Rd</p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Imm</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>指令功能及操作码编码见<a href="#tab-7">表 1</a>。R型指令的两个源操作数均来自寄存器，分别由Rs1和Rs2给出寄存器号。I型指令的一个源操作数来自寄存器，由Rs1给出寄存器号；另一个源操作数是立即数，由指令的Imm字段提供。运算结果存入由Rd指定的寄存器中。B型指令根据rs1和rs2的大小关系决定是顺序执行下一条指令，还是跳转去执行地址为Imm的指令。</p>
</div>
<table id="tab-7" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">表 1. 指令功能及操作码编码表</caption>
<colgroup>
<col style="width: 19%;">
<col style="width: 35%;">
<col style="width: 17%;">
<col style="width: 29%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">指令类型</th>
<th class="tableblock halign-left valign-top">指令助记符</th>
<th class="tableblock halign-left valign-top">OPCODE</th>
<th class="tableblock halign-left valign-top">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="5"><p class="tableblock">R型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">add rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)＋(rs2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)－(rs2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">and rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)∧(rs2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)∨(rs2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xor rd, rs1, rs2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)⊕(rs2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="4"><p class="tableblock">I型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addi rd, rs1, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)＋imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">andi rd, rs1, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)∧imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ori rd, rs1, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)∨imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xori rd, rs1, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rd←(rs1)⊕imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="4"><p class="tableblock">B型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">beq rs1, rs2, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1=rs2) goto imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bne rs1, rs2, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1≠rs2) goto imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blt rs1, rs2, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1&lt;rs2) goto imm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bge rs1, rs2, #imm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if (rs1≥rs2) goto imm</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_指令部件"><a class="anchor" href="#_指令部件"></a>指令部件</h3>
<div class="paragraph">
<p>指令存储器的字长是14位，有16个存储单元，可以存放16条指令。因此指令存储器的地址需4位，由程序计数器PC提供。复位时PC值为0，即第一条指令的地址。在Clk上升沿到来时，如果Load为1，则将Imm装入PC，实现程序转移；否则PC值加1，即顺序执行。</p>
</div>
<div class="paragraph">
<p>指令存储器是只读存储器，可以使用存储器实验中的ROM模块，在初始化部分写入要执行的指令编码。下面的例子给出了4条指令的编码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logic [13:0] mem[0:15];
initial begin
// 13__10 9_8 7_6 54 3_0
// OPCODE Rs1 Rs2 Rd Imm
mem[0] = 14'b0110_00_00_01_0101; // addi r1, r0, #5
mem[1] = 14'b1000_00_00_10_1010; // ori r2, r0, #10
mem[2] = 14'b0010_01_10_11_0000; // sub r3, r1, r2
mem[3] = 14'b1011_10_11_00_0000; // bne r2, r3, #0
end</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_控制器"><a class="anchor" href="#_控制器"></a>控制器</h3>
<div class="paragraph">
<p>控制器以指令opcode作为输入，为数据通路中所有单元产生控制信号。</p>
</div>
<div class="paragraph">
<p><a href="#fig-31">图 2</a>单周期数据通路中，需要如下控制信号：</p>
</div>
<div class="paragraph">
<p>（1）PC的load信号：为0时，PC加1；为1时，PC装载来自imm的立即数。</p>
</div>
<div class="paragraph">
<p>（2）寄存器堆的写入信号：为1时，寄存器堆执行写入操作。</p>
</div>
<div class="paragraph">
<p>（3）多路器的选择信号：为0时，ALU的Y操作数，来自寄存器堆的RD2输出；为1时，ALU的Y操作数，来自立即数imm。</p>
</div>
<div class="paragraph">
<p>（4）ALU的运算控制信号ALUop：根据之前ALU实验的设计要求，操作对应的编码为：[width="100%",cols="46%,54%",]</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ALUop（4位）</th>
<th class="tableblock halign-left valign-top">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0010</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>数据通路中的指令存储器，内容在设计时预先写入，只提供读访问，根据输入地址，输出该地址单元存储的内容，不需要控制器产生控制信号。</p>
</div>
<div class="paragraph">
<p>因为指令系统的简单和规整，对控制器的设计，就是设计译码过程来确定控制信号。对于指令系统中的R型和I型指令，控制器根据opcode的值，译码产生数据通路上的各个控制信号，实现指令功能。对于指令系统中的B型指令，控制器还需要来自ALU产生的标志位或者比较结果，与Opcode的值一起，译码产生控制信号。</p>
</div>
</div>
<div class="sect2">
<h3 id="_实验任务"><a class="anchor" href="#_实验任务"></a>实验任务</h3>
<div class="paragraph">
<p>用HDL设计<a href="#fig-31">图 2</a>电路。控制器根据opcode产生相应的控制信号。在实验平台验证设计。</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">许可 | License</div>
<div class="paragraph">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA：署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
